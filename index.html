<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Chat</title>
    </head>
 
    <body>
        <h1>Communication with socket.io!</h1>
		<form action="" method="" id="chatform" accept-charset="utf-8">
			<input type="text" id="message" name="message"  placeholder="type your message here" />
			<input id="send" type="submit" value="Send">
		</form>

		<section id='chatzone'></section>
		<!--path to node module file socket -->
        <script src="/socket.io/socket.io.js"></script>
		<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
		<!-- connect to correct port-->
	   <script>
            const socket = io.connect('http://localhost:9876');
			//remembers pseudo when someone logs in localhost 9876
			const  pseudo = prompt('What is your username ?', 'Anonymous');
			socket.emit('newSockConnecting', pseudo); //sends to the client
			//shows with user is talking
			document.title = pseudo + ' - ' + document.title;
			
			//when receive a message insert into page 
			socket.on('message', (data) => {
			//use function defined below
				insertMessage(data.pseudo, data.message);
			//document.getElementById('reponse').innerHTML =' The master socket has a message for you : ' + message;
			});
			
			//new user connects
			socket.on('newSockConnecting', (pseudo) => {
				document.getElementById('chatzone').innerHTML = 'Sock ' + pseudo + ' joined the chat';
			});

			//when user clicks on element sock, message sent to server
			document.getElementById('send').addEventListener('submit', () => {
				const message = document.getElementById('message').value;
				socket.emit('message', message); //send msg all users
				insertMessage(pseudo, message); // affiche msg
				document.getElementById('message').innerHTML.focus() = ''; //set var msg to 0
				return false;
//socket.on('message', (message) => {
				//	document.getElementById('reponseinput').innerHTML = input;
			//});

				//socket.emit('message', 'Hello master socket, how are you?');
			
			});

			//add msg into page
			function insertMessage(pseudo, message){
				document.getElementById('chatzone').innerHTML = 'Sock ' + pseudo + ': ' + message;
			}
        
		</script>
    </body>
</html>
